{% extends "parent.html" %}

{% block title %} - {{juggler.name}}{% endblock %}

{% block content %}
<h2>{{juggler.name}} - {{juggler.score}} points - {{juggler.total_value|floatformat:2}} total value</h2>
<h3>Achievements</h3>
<form action="alter_achievements" method="post">
<table id="achieved" class="display">
  <thead>
    <tr>
        <th>Remove?</th>
        <th>Achievement</th>
        <th>Points</th>
        <th>Value</th>
        <th>Type</th>
        <th>Date Achieved</th>
    </tr>
  </thead>
  <tbody>
    {% for ach in achievements %}
    <tr class="achieved_row value-{{ach.achievement.value|floatformat:2|cut:'.'}}">
        <td><input type="checkbox" name="remove" value="{{ach.achievement.id}}" /></td>
        <td><a href="../../achievement/{{ach.achievement.id}}">{{ach.achievement.name}}</a></td>
        <td>{{ach.achievement.points}}</td>
        <td class="points">{{ach.achievement.value|floatformat:2}}</td>
        <td>{{ach.achievement.get_kind_display|title}}</td>
        <td>{{ach.date_created|date:"M d, Y @ H:i"}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<br />
<h3>Achievements Not Yet Achieved</h3>
    <table id="unachieved" class="display">
      <thead>
        <tr>
            <th>Add?</th>
            <th>Achievement</th>
            <th>Points</th>
            <th>Value</th>
            <th>Type</th>
        </tr>
      </thead>
      <tbody>
        {% for unach in unachieved %}
        <tr class="unachieved_row value-{{unach.value|floatformat:2|cut:'.'}}">
            <td><input type="checkbox" name="add" value="{{ unach.id }}" /></td>
            <td><a href="../../achievement/{{unach.id}}">{{unach.name}}</a></td>
            <td>{{unach.points}}</td>
            <td class="points">{{unach.value|floatformat:2}}</td>
            <td>{{unach.get_kind_display|title}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br />
    <input class="submit_button" type="submit" value="Submit" />
</form>
{% endblock %}

{% block initjs %}
<script type="text/javascript">
$(document).ready(function() {
  var t = $('#achieved');
  var t1 = $('#achieved').dataTable({
    "bPaginate": false,
    "aaSorting": [[ 2, "asc" ]],
  });
  var t2 = $('#unachieved').dataTable({
    "bPaginate": false,
    "aaSorting": [[ 2, "asc" ]],
  });

  $.map([t1, t2], function(table) {
    var pointValues = [''];
    table.find('td.points').each(function() {
      var pointValue = parseInt($(this).html());
      var exists = false;
      for(var i = 0; i< pointValues.length; i++) {
        if(pointValues[i] === pointValue) {
          exists = true;
          break;
        }
      }
      if(!exists) {
        pointValues.push(pointValue);
      }
    });
    var pointFilter = $('<select></select>').attr('name', 'points');
    var makeOption = function(value) {
      var option = $('<option></option>').attr('value', value).html((value === '') ? 'All' : value);
      pointFilter.append(option);
    };
    $.map(pointValues, makeOption);
    pointFilter.change(function() {
      table.fnFilter(this.value, 2);
    });
    $("#" + table.attr('id') + "_filter").before($('<label></label>').html('Show Achievements with Points: ').append(pointFilter));
  });
});
</script>
{% endblock %}
