{% extends "parent.html" %}

{% block title %} - {{juggler.name}}{% endblock %}

{% block content %}
<h2>{{juggler.name}} - {{juggler.total_value|floatformat:2}} total value</h2>
<h3>Achievements</h3>
<form action="alter_achievements" method="post">
<table id="achieved" class="display">
  <thead>
    <tr>
        <th>Remove?</th>
        <th>Achievement</th>
        <th>Value</th>
        <th>Type</th>
        <th>Date Achieved</th>
    </tr>
  </thead>
  <tbody>
    {% for ach in achievements %}
    <tr>
        <td><input type="checkbox" name="remove" value="{{ach.achievement.id}}" /></td>
        <td><a href="../../achievement/{{ach.achievement.id}}">{{ach.achievement.name}}</a></td>
        <td class="value">{{ach.achievement.value|floatformat:2}}</td>
        <td>{{ach.achievement.get_kind_display|title}}</td>
        <td>{{ach.date_created|date:"M d, Y @ H:i"}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<br />
<h3>Achievements Not Yet Achieved</h3>
    <table id="unachieved" class="display">
      <thead>
        <tr>
            <th>Add?</th>
            <th>Achievement</th>
            <th>Value</th>
            <th>Type</th>
        </tr>
      </thead>
      <tbody>
        {% for unach in unachieved %}
        <tr>
            <td><input type="checkbox" name="add" value="{{ unach.id }}" /></td>
            <td><a href="../../achievement/{{unach.id}}">{{unach.name}}</a></td>
            <td class="value">{{unach.value|floatformat:2}}</td>
            <td>{{unach.get_kind_display|title}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br />
    <input class="submit_button" type="submit" value="Submit" />
</form>
{% endblock %}

{% block initjs %}
<script type="text/javascript">
$(document).ready(function() {
  var renderNAs = function(obj) {
    if (obj.aData[2] == "101.00")
      return "N/A";
    return obj.aData[2];
  }

  var t1 = $('#achieved').dataTable({
    "bPaginate": false,
    "aaSorting": [[ 2, "asc" ]],
    "aoColumns": [null, {"sType": "html"},
            {"sType": "numeric",
             "fnRender": renderNAs,
             "bUseRendered": false},
             null, null]
  });
  var t2 = $('#unachieved').dataTable({
    "bPaginate": false,
    "aaSorting": [[ 2, "asc" ]],
    "aoColumns": [null, {"sType": "html"},
            {"sType": "numeric",
             "fnRender": renderNAs,
             "bUseRendered": false},
             null]
  });

  $.map([t1, t2], function(table) {
    var values = [''];
    table.find('td.value').each(function() {
      var value = $(this).html();
      var exists = false;
      for(var i = 0; i< values.length; i++) {
        if(values[i] === value) {
          exists = true;
          break;
        }
      }
      if(!exists) {
        values.push(value);
      }
    });
    var valueFilter = $('<select></select>').attr('name', 'value');
    var makeOption = function(value) {
      var option = $('<option></option>').attr('value', value).html((value === '') ? 'All' : value);
      valueFilter.append(option);
    };
    $.map(values, makeOption);
    valueFilter.change(function() {
      if (this.value == "N/A")
        table.fnFilter("101.00", 2);
      else
        table.fnFilter(this.value, 2);
    });
    $("#" + table.attr('id') + "_filter").before($('<label></label>').html('Show Achievements with Value: ').append(valueFilter));
  });
});
</script>
{% endblock %}
